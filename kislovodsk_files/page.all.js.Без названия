(function(e,t){if(typeof exports=="object")module.exports=t();else if(typeof define=="function"&&define.amd)define(t);else e.Spinner=t()})(this,function(){"use strict";var e=["webkit","Moz","ms","O"],t={},i;function o(e,t){var i=document.createElement(e||"div"),o;for(o in t)i[o]=t[o];return i}function n(e){for(var t=1,i=arguments.length;t<i;t++)e.appendChild(arguments[t]);return e}var s=function(){var e=o("style",{type:"text/css"});n(document.getElementsByTagName("head")[0],e);return e.sheet||e.styleSheet}();function a(e,o,n,a){var r=["opacity",o,~~(e*100),n,a].join("-"),l=.01+n/a*100,d=Math.max(1-(1-e)/o*(100-l),e),c=i.substring(0,i.indexOf("Animation")).toLowerCase(),f=c&&"-"+c+"-"||"";if(!t[r]){s.insertRule("@"+f+"keyframes "+r+"{"+"0%{opacity:"+d+"}"+l+"%{opacity:"+e+"}"+(l+.01)+"%{opacity:1}"+(l+o)%100+"%{opacity:"+e+"}"+"100%{opacity:"+d+"}"+"}",s.cssRules.length);t[r]=1}return r}function r(t,i){var o=t.style,n,s;i=i.charAt(0).toUpperCase()+i.slice(1);for(s=0;s<e.length;s++){n=e[s]+i;if(o[n]!==undefined)return n}if(o[i]!==undefined)return i}function l(e,t){for(var i in t)e.style[r(e,i)||i]=t[i];return e}function d(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var o in i)if(e[o]===undefined)e[o]=i[o]}return e}function c(e){var t={x:e.offsetLeft,y:e.offsetTop};while(e=e.offsetParent)t.x+=e.offsetLeft,t.y+=e.offsetTop;return t}function f(e,t){return typeof e=="string"?e:e[t%e.length]}var m={lines:12,length:7,width:5,radius:10,rotate:0,corners:1,color:"#000",direction:1,speed:1,trail:100,opacity:1/4,fps:20,zIndex:2e9,className:"spinner",top:"50%",left:"50%",position:"absolute"};function u(e){this.opts=d(e||{},u.defaults,m)}u.defaults={};d(u.prototype,{spin:function(e){this.stop();var t=this,n=t.opts,s=t.el=l(o(0,{className:n.className}),{position:n.position,width:0,zIndex:n.zIndex}),a=n.radius+n.length+n.width;if(e){e.insertBefore(s,e.firstChild||null);l(s,{left:n.left,top:n.top})}s.setAttribute("role","progressbar");t.lines(s,t.opts);if(!i){var r=0,d=(n.lines-1)*(1-n.direction)/2,c,f=n.fps,m=f/n.speed,u=(1-n.opacity)/(m*n.trail/100),p=m/n.lines;(function h(){r++;for(var e=0;e<n.lines;e++){c=Math.max(1-(r+(n.lines-e)*p)%m*u,n.opacity);t.opacity(s,e*n.direction+d,c,n)}t.timeout=t.el&&setTimeout(h,~~(1e3/f))})()}return t},stop:function(){var e=this.el;if(e){clearTimeout(this.timeout);if(e.parentNode)e.parentNode.removeChild(e);this.el=undefined}return this},lines:function(e,t){var s=0,r=(t.lines-1)*(1-t.direction)/2,d;function c(e,i){return l(o(),{position:"absolute",width:t.length+t.width+"px",height:t.width+"px",background:e,boxShadow:i,transformOrigin:"left",transform:"rotate("+~~(360/t.lines*s+t.rotate)+"deg) translate("+t.radius+"px"+",0)",borderRadius:(t.corners*t.width>>1)+"px"})}for(;s<t.lines;s++){d=l(o(),{position:"absolute",top:1+~(t.width/2)+"px",transform:t.hwaccel?"translate3d(0,0,0)":"",opacity:t.opacity,animation:i&&a(t.opacity,t.trail,r+s*t.direction,t.lines)+" "+1/t.speed+"s linear infinite"});if(t.shadow)n(d,l(c("#000","0 0 4px "+"#000"),{top:2+"px"}));n(e,n(d,c(f(t.color,s),"0 0 1px rgba(0,0,0,.1)")))}return e},opacity:function(e,t,i){if(t<e.childNodes.length)e.childNodes[t].style.opacity=i}});function p(){function e(e,t){return o("<"+e+' xmlns="urn:schemas-microsoft.com:vml" class="spin-vml">',t)}s.addRule(".spin-vml","behavior:url(#default#VML)");u.prototype.lines=function(t,i){var o=i.length+i.width,s=2*o;function a(){return l(e("group",{coordsize:s+" "+s,coordorigin:-o+" "+-o}),{width:s,height:s})}var r=-(i.width+i.length)*2+"px",d=l(a(),{position:"absolute",top:r,left:r}),c;function m(t,s,r){n(d,n(l(a(),{rotation:360/i.lines*t+"deg",left:~~s}),n(l(e("roundrect",{arcsize:i.corners}),{width:o,height:i.width,left:i.radius,top:-i.width>>1,filter:r}),e("fill",{color:f(i.color,t),opacity:i.opacity}),e("stroke",{opacity:0}))))}if(i.shadow)for(c=1;c<=i.lines;c++)m(c,-2,"progid:DXImageTransform.Microsoft.Blur(pixelradius=2,makeshadow=1,shadowopacity=.3)");for(c=1;c<=i.lines;c++)m(c);return n(t,d)};u.prototype.opacity=function(e,t,i,o){var n=e.firstChild;o=o.shadow&&o.lines||0;if(n&&t+o<n.childNodes.length){n=n.childNodes[t+o];n=n&&n.firstChild;n=n&&n.firstChild;if(n)n.opacity=i}}}var h=l(o("group"),{behavior:"url(#default#VML)"});if(!r(h,"transform")&&h.adj)p();else i=r(h,"animation");return u});var isTouch=!!(document.createTouch!==undefined||"ontouchstart"in window||"onmsgesturechange"in window||navigator.msMaxTouchPoints);$(document).ready(function(){var e=$("#place-photos");if(e.length===0)return;e.addClass("ready");var t=e.attr("data-author-tpl"),i=e.attr("data-full-size-text"),o=window.location.hash.match(/photo\/(\d+)/),n=window.location.protocol+"//"+window.location.host,s;if(o){o=o[1];o=e.find(".thumb-link[data-id="+o+"]");o=o?parseInt(o.attr("data-num"))-1:undefined}if(!isTouch){s=['<div id="swipebox-overlay">','<div id="swipebox-slider"></div>','<div class="swipebox-caption">','<span class="logo" onclick="closeGallery();"></span><div class="content"></div>','<a id="swipebox-close"><i class="control-icon"></i></a>',"</div>",'<div class="swipebox-action left">','<a id="swipebox-prev"><i class="control-icon"></i></a></div>','<div class="swipebox-action right">','<a id="swipebox-next"><i class="control-icon"></i></a></div>',"</div>"].join("")}var a=$("html").hasClass("swipebox-light"),r={position:"relative",lines:12,length:12,width:a?5:4,radius:10,corners:1,rotate:0,trail:60,speed:1,top:"50%",direction:1,color:a?"#999":"#fff",zIndex:90};var l=window.swipebox=new Swipebox($("#place-photos"),{galleryItemClass:"thumb-link",startIndex:o,template:s,slideAnimation:isTouch,presumeProgressive:true,prefilterUrl:function(e){var t=this.winSize.x,i="_big";if(t<=1024){}else if(t<1300){i="_960"}else if(t>=1300){i="_1280"}e=e.replace("_big",i);return e},setPreloader:function(e){if(!this._spinner){var t=document.getElementById("swipebox-overlay");this._spinner=new Spinner(r).spin(t)}},onSlide:function(e,t){if(!isTouch){window.location.hash="/photo/"+t.id}if(parent.app){parent.app.map.fireEvent("photo_shown",[t.id,place])}},onClose:function(){removeHash();parent.postMessage({fullScreen:false},n);if(parent.app){parent.app.map.fireEvent("photo_close",place)}},onInitGallery:function(){parent.postMessage({fullScreen:true},n)},getItemData:function(e){var o,e=$(e),n=e.attr("href"),s,r,l=e.attr("title").split(/\|/g),d,c=l.pop();if(isTouch){l=c}else{l=(l.join("")||"&nbsp;")+'<span class="label">'+c+"</span>"}d='<div class="title">';if(e.attr("data-full-url")){d+='<a href="'+e.attr("data-full-url")+'" class="icon'+(a?"":" icon-white")+' icon-resize-full" target="_blank" title="'+i+'"';if(false&&parent.app){d+=" onclick=\"$('#swipebox-slider .current img').attr('src', '"+e.attr("data-full-url")+"'); return false;\""}d+="></a>"}d+='<span class="title-text">'+l+"</span></div>";r=parseInt(e.attr("data-user-id"));if(r){var f="/user/"+r+"/";o='<a rel="profile" class="user" href="/#show='+f+'"';if(parent&&parent.app){o+=' onclick="goToProfile('+r+');return false;"'}o+=">"+e.attr("data-user-name")+"</a>";s='<span class="date">'+e.attr("data-uploaded")+"</span>";d+='<div class="details">'+t.replace("%username%",o).replace("%time_ago%",s)+"</div>"}return{title:d,href:n||null,id:e.attr("data-id")}}});this.goToProfile=function(e){l.destroy();setTimeout(function(){parent.router.route("/user/"+e+"/")},500)};this.closeGallery=function(){l.destroy()}});(function(e,t,i,o,n,s,a){if(!Function.prototype.bind){Function.prototype.bind=function(){var e=this,t=Array.prototype.slice.call(arguments),i=t.shift();return function(){return e.apply(i,t.concat(Array.prototype.slice.call(arguments)))}}}i.fn.every=function(e){var t=true;this.each(function(){t=t&&e(i(this))});return t};var r=!!e.SVGSVGElement,l=function(e){var i=t.createElement("div");e=e.split(" ");for(var o=0;o<e.length;o++){if(i.style[e[o]]!==a){return true}}return false}("transition WebkitTransition MozTransition OTransition msTransition KhtmlTransition");var d=function(e,t){this.options=i.extend(this.options,t);if(this.options.getItemData){this.getItemData=this.options.getItemData}this.elements=e.filter(this.options.galleryItemClass).length>0?e:this.getElements(e);this.initGallery(this.options.startIndex)};d.prototype={constructor:d,options:{useCSS:true,initialIndexOnArray:0,hideBarsDelay:4e3,videoMaxWidth:1140,barsAnimationTimeout:500,slideAnimation:true,trembleDuration:500,vimeoColor:"CCCCCC",onSlide:null,nextOnClick:true,startIndex:null,preloaderOptions:{},presumeProgressive:false,galleryItemClass:"swipebox",template:['<div id="swipebox-overlay">','<div id="swipebox-slider"></div>','<div class="swipebox-caption">','<div class="content"></div>','<a id="swipebox-close"><i class="control-icon"></i></a>',"</div>",'<div class="swipebox-action">','<a id="swipebox-prev"><i class="control-icon"></i></a>','<a id="swipebox-next"><i class="control-icon"></i></a>',"</div></div>"].join(""),prefilterUrl:function(e){return e}},elements:null,isOpen:false,index:0,useCssTransitions:function(){return this.options.useCSS&&l},getElements:function(e){$container=i(e);var t=$container.find("."+this.options.galleryItemClass),o=[],n=this;t.each(function(e,t){var s=i(t);s.on("click",function(t){t.stopPropagation();t.preventDefault();n.initInternal();n.openSlide(e);n.openMedia(e);n.preloadMedia(e+1);n.preloadMedia(e-1)});var a=s.attr("title")||null,r=s.attr("href")||null;o.push(n.getItemData(s.get(0)))});return o},getItemData:function(e){return{title:$item.attr("title")||null,href:$item.attr("href")||null}},initGallery:function(e){if(e!==null&&!isNaN(e)){this.initInternal();this.openSlide(e);this.openMedia(e);this.preloadMedia(e+1);this.preloadMedia(e-1)}},initInternal:function(){if(this.isOpen)return;if(this.options.onInitGallery){this.options.onInitGallery(this)}this.isOpen=true;var e=i(this),o=i("<div></div>");o.html(this.options.template);i(t.body).append(o.children(":first-child"));if(this.useCssTransitions()){i("#swipebox-slider,#swipebox-overlay,.swipebox-action,.swipebox-caption").addClass("animation")}if(!this.options.slideAnimation){i("#swipebox-slider").removeClass("animation")}if(r){i("#swipebox-overlay").addClass("svg")}i("#swipebox-slider").html(i("#swipebox-slider").html()+Array(this.elements.length+1).join('<div class="slide"></div>'));this.setDim();this.setActions();this.setUpKeyboard();this.setUpGestures();this.animBars()},setDim:function(){if("onorientationchange"in e){i(e).on("orientationchange",this.onWindowResize.bind(this))}i(e).on("resize",this.onWindowResize.bind(this));this.onWindowResize()},onWindowResize:function(){var t=parent!==self?parent:e,o={x:Math.max(i(t).width(),t.innerWidth),y:Math.max(i(t).height(),t.innerHeight)};this.winSize=o;i("#swipebox-overlay").css({width:o.x,height:o.y})},setActions:function(){if(this.elements.length<2){i("#swipebox-prev, #swipebox-next").css("display","none")}else{var e=i.proxy(this.onPreviousClick,this),t=i.proxy(this.onNextClick,this);i("#swipebox-prev").on("click",e).on("touchend",e);i("#swipebox-next").on("click",t).on("touchend",t)}var o=i.proxy(this.onCloseClick,this);i("#swipebox-close").on("click",o).on("touchend",o)},onCloseClick:function(e){e.stopPropagation();e.preventDefault();this.closeSlide()},onPreviousClick:function(e){e.stopPropagation();e.preventDefault();this.getPrev();this.setTimeout()},onNextClick:function(e){e.stopPropagation();e.preventDefault();this.getNext();this.setTimeout()},setUpKeyboard:function(){i(e).on("keyup",function(e){if(this.isOpen){switch(e.keyCode){case 37:this.getPrev();break;case 39:this.getNext();break;case 27:this.closeSlide();break;default:break}}}.bind(this))},setUpGestures:function(){if(!s){return}var e=this,o=null,n=10,a={},r={},l=this.getBars();l.addClass("visible-bars");this.setTimeout();i(t.body).on({touchstart:function(t){var s=t.originalEvent.targetTouches;t.stopPropagation();t.preventDefault();i(this).addClass("touching");r=s[0];a.pageX=s[0].pageX;delete e.swipeShowBars;i(".touching").on({touchmove:function(t){t.stopPropagation();t.preventDefault();r=t.originalEvent.targetTouches[0];if(!e.swipeShowBars&&!l.every(function(e){return e.hasClass("visible-bars")})){e.showBars();e.clearTimeout();e.swipeShowBars=true}},touchend:function(t){t.stopPropagation();t.preventDefault();o=r.pageX-a.pageX;if(e.swipeShowBars){e.setTimeout()}if(o>=n){e.getPrev()}else if(o<=-n){e.getNext()}else{if(!l.every(function(e){return e.hasClass("visible-bars")})){e.showBars();e.setTimeout()}else if(!e.swipeShowBars){e.clearTimeout();e.hideBars()}}i(".touching").off("touchmove").off("touchend").removeClass("touching")}});return false}})},setTimeout:function(){if(this.options.hideBarsDelay>0){this.clearTimeout();this.timeout=setTimeout(i.proxy(this.hideBars,this),this.options.hideBarsDelay)}},clearTimeout:function(){e.clearTimeout(this.timeout);this.timeout=null},getBars:function(){return i(".swipebox-caption, .swipebox-action")},toggleBars:function(e){var t=this.getBars();if(this.useCssTransitions()){t[e?"addClass":"removeClass"]("visible-bars")}else{this.animateControls(t,e)}},showBars:function(){this.toggleBars(true)},hideBars:function(){this.toggleBars(false)},animateControls:function(e,t){var o=t?0:-50,n={duration:this.options.barsAnimationTimeout};i(".swipebox-caption").animate({top:o},n);i(".swipebox-action").animate({bottom:o},n);setTimeout(function(){e[t?"addClass":"removeClass"]("visible-bars")},1e3)},animBars:function(){var e=this,t=this.getBars();t.addClass("visible-bars");if(s){this.setTimeout()}i("#swipebox-slider").on("click",i.proxy(function(e){if(!t.every(function(e){return e.hasClass("visible-bars")})){this.showBars()}else if(!s&&this.options.nextOnClick){this.getNext()}if(s){this.setTimeout()}},this));i(".swipebox-action").on({mouseenter:i.proxy(function(){this.showBars();t.addClass("force-visible-bars");this.clearTimeout()},this),mouseleave:i.proxy(function(){t.removeClass("force-visible-bars");this.setTimeout()},this)})},openSlide:function(t){i("html").addClass("swipebox");i(e).trigger("resize");this.setSlide(t,true)},setSlide:function(e,t){t=t||false;var o=i("#swipebox-slider"),n=o.find(".slide"),s=n.eq(e);if(t){o.removeClass("animation");o.css("left",-e*100+"%");if(this.options.slideAnimation){setTimeout(function(){o.addClass("animation")},this.options.barsAnimationTimeout)}}else if(this.useCssTransitions()||!this.options.slideAnimation){o.css("left",-e*100+"%")}else{o.animate({left:-e*100+"%"})}n.removeClass("current");s.addClass("current");this.setTitle(e);if(t){o.fadeIn()}i("#swipebox-prev, #swipebox-next").removeClass("disabled");if(e===0){i("#swipebox-prev").addClass("disabled")}else if(e===this.elements.length-1){i("#swipebox-next").addClass("disabled")}if(this.options.onSlide){this.options.onSlide(e,this.elements[e])}},preloadMedia:function(e){var t=null;if(this.elements[e]!==a){t=this.elements[e].href}if(!this.isVideo(t)){setTimeout(i.proxy(function(){this.openMedia(e)},this),1e3)}else{this.openMedia(e)}},openMedia:function(e){var t=null,o=this;if(this.elements[e]!==a){t=this.elements[e].href}if(e<0||e>=this.elements.length){return false}if(this.isVideo(t)){i("#swipebox-slider .slide")[e].html("").append(this.getVideo(t))}else{var n=i("#swipebox-slider .slide")[e];if(this.options.setPreloader){this.options.setPreloader.call(this,n)}this.loadMedia(t,function(e){if(n){n.innerHTML="";n.appendChild(e);if(!s){i(e).on("mousemove",function(){o.showBars();o.setTimeout()})}}})}},setTitle:function(e,t){var o=null,n=i(".swipebox-caption .content");n.html("");if(this.elements[e]!==a){o=this.elements[e].title}if(o){n.html(o)}},isVideo:function(e){return e&&/youtube\.com\/watch\?v=([a-zA-Z0-9\-_]+)/.test(e)||/vimeo\.com\/([0-9]*)/.test(e)},getVideo:function(e){var t="",i="",o=e.match(/watch\?v=([a-zA-Z0-9\-_]+)/),n=e.match(/vimeo\.com\/([0-9]*)/);if(o){t=['<iframe width="560" height="315" src="//www.youtube.com/embed/',o[1],'" frameborder="0" allowfullscreen></iframe>']}else if(n){t=['<iframe width="560" height="315"  src="http://player.vimeo.com/video/',n[1],"?byline=0&amp;portrait=0&amp;color=",this.options.vimeoColor,'" frameborder="0" webkitAllowFullScreen'," mozallowfullscreen allowFullScreen></iframe>"]}return['<div class="swipebox-video-container" style="max-width:',this.options.videomaxWidth,'px"><div class="swipebox-video">',t.join(""),"</div></div>"].join("")},loadMedia:function(e,t){if(!this.isVideo(e)){var i=new Image;e=this.options.prefilterUrl.call(this,e);if(this.options.presumeProgressive){i.src=e;t(i)}else{i.onload=function(){t(this)};i.src=e}}},getNext:function(){var e=i("#swipebox-slider .slide").index(i("#swipebox-slider .slide.current"));if(e+1<this.elements.length){e++;this.setSlide(e);setTimeout(function(){this.preloadMedia(e+1)}.bind(this),200)}else{this.trembleSlide(i("#swipebox-slider"),false)}},getPrev:function(){var e=i("#swipebox-slider .slide").index(i("#swipebox-slider .slide.current"));if(e>0){e--;this.setSlide(e);this.preloadMedia(e-1)}else{this.trembleSlide(i("#swipebox-slider"),true)}},trembleSlide:function(e,t){var i=(t?"left":"right")+"Spring";e.addClass(i);setTimeout(function(){e.removeClass(i)},this.options.trembleDuration)},closeSlide:function(){i("html").removeClass("swipebox");i(e).trigger("resize");this.destroy()},destroy:function(){i("html").removeClass("swipebox");i(e).off("keyup");var o=i(t.body);o.off("touchstart");o.off("touchmove");o.off("touchend");i("#swipebox-slider").off();i("#swipebox-overlay").remove();this.isOpen=false;if(this.options.onClose){this.options.onClose()}}};this.Swipebox=d})(window,document,jQuery,Object.append,function(e){return Object.prototype.toString(e)==="[object Array]"},isTouch);!function(e){"use strict";e(function(){e.support.transition=function(){var e=function(){var e=document.createElement("bootstrap"),t={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"},i;for(i in t){if(e.style[i]!==undefined){return t[i]}}}();return e&&{end:e}}()})}(window.jQuery);!function(e){"use strict";var t=function(t,i){this.options=i;this.$element=e(t).delegate('[data-dismiss="modal"]',"click.dismiss.modal",e.proxy(this.hide,this));this.options.remote&&this.$element.find(".modal-body").load(this.options.remote)};t.prototype={constructor:t,toggle:function(){return this[!this.isShown?"show":"hide"]()},show:function(){var t=this,i=e.Event("show");this.$element.trigger(i);if(this.isShown||i.isDefaultPrevented())return;this.isShown=true;this.escape();this.backdrop(function(){var i=e.support.transition&&t.$element.hasClass("fade");if(!t.$element.parent().length){t.$element.appendTo(document.body)}t.$element.show();if(i){t.$element[0].offsetWidth}t.$element.addClass("in").attr("aria-hidden",false);t.enforceFocus();i?t.$element.one(e.support.transition.end,function(){t.$element.focus().trigger("shown")}):t.$element.focus().trigger("shown")})},hide:function(t){t&&t.preventDefault();var i=this;t=e.Event("hide");this.$element.trigger(t);if(!this.isShown||t.isDefaultPrevented())return;this.isShown=false;this.escape();e(document).off("focusin.modal");this.$element.removeClass("in").attr("aria-hidden",true);e.support.transition&&this.$element.hasClass("fade")?this.hideWithTransition():this.hideModal()},enforceFocus:function(){var t=this;e(document).on("focusin.modal",function(e){if(t.$element[0]!==e.target&&!t.$element.has(e.target).length){t.$element.focus()}})},escape:function(){var e=this;if(this.isShown&&this.options.keyboard){this.$element.on("keyup.dismiss.modal",function(t){t.which==27&&e.hide()})}else if(!this.isShown){this.$element.off("keyup.dismiss.modal")}},hideWithTransition:function(){var t=this,i=setTimeout(function(){t.$element.off(e.support.transition.end);t.hideModal()},500);this.$element.one(e.support.transition.end,function(){clearTimeout(i);t.hideModal()})},hideModal:function(){var e=this;this.$element.hide();this.backdrop(function(){e.removeBackdrop();e.$element.trigger("hidden")})},removeBackdrop:function(){this.$backdrop&&this.$backdrop.remove();this.$backdrop=null},backdrop:function(t){var i=this,o=this.$element.hasClass("fade")?"fade":"";if(this.isShown&&this.options.backdrop){var n=e.support.transition&&o;this.$backdrop=e('<div class="modal-backdrop '+o+'" />').appendTo(document.body);this.$backdrop.click(this.options.backdrop=="static"?e.proxy(this.$element[0].focus,this.$element[0]):e.proxy(this.hide,this));if(n)this.$backdrop[0].offsetWidth;this.$backdrop.addClass("in");if(!t)return;n?this.$backdrop.one(e.support.transition.end,t):t()}else if(!this.isShown&&this.$backdrop){this.$backdrop.removeClass("in");e.support.transition&&this.$element.hasClass("fade")?this.$backdrop.one(e.support.transition.end,t):t()}else if(t){t()}}};var i=e.fn.modal;e.fn.modal=function(i){return this.each(function(){var o=e(this),n=o.data("modal"),s=e.extend({},e.fn.modal.defaults,o.data(),typeof i=="object"&&i);if(!n)o.data("modal",n=new t(this,s));if(typeof i=="string")n[i]();else if(s.show)n.show()})};e.fn.modal.defaults={backdrop:true,keyboard:true,show:true};e.fn.modal.Constructor=t;e.fn.modal.noConflict=function(){e.fn.modal=i;return this};e(document).on("click.modal.data-api",'[data-toggle="modal"]',function(t){var i=e(this),o=i.attr("href"),n=e(i.attr("data-target")||o&&o.replace(/.*(?=#[^\s]+$)/,"")),s=n.data("modal")?"toggle":e.extend({remote:!/#/.test(o)&&o},n.data(),i.data());t.preventDefault();n.modal(s).one("hide",function(){i.focus()})})}(window.jQuery);!function(e){"use strict";var t=function(t){this.element=e(t)};t.prototype={constructor:t,show:function(){var t=this.element,i=t.closest("ul:not(.dropdown-menu)"),o=t.attr("data-target"),n,s,a;if(!o){o=t.attr("href");o=o&&o.replace(/.*(?=#[^\s]*$)/,"")}if(t.parent("li").hasClass("active"))return;n=i.find(".active:last a")[0];a=e.Event("show",{relatedTarget:n});t.trigger(a);if(a.isDefaultPrevented())return;s=e(o);this.activate(t.parent("li"),i);this.activate(s,s.parent(),function(){t.trigger({type:"shown",relatedTarget:n})})},activate:function(t,i,o){var n=i.find("> .active"),s=o&&e.support.transition&&n.hasClass("fade");function a(){n.removeClass("active").find("> .dropdown-menu > .active").removeClass("active");t.addClass("active");if(s){t[0].offsetWidth;t.addClass("in")}else{t.removeClass("fade")}if(t.parent(".dropdown-menu")){t.closest("li.dropdown").addClass("active")}o&&o()}s?n.one(e.support.transition.end,a):a();n.removeClass("in")}};var i=e.fn.tab;e.fn.tab=function(i){return this.each(function(){var o=e(this),n=o.data("tab");if(!n)o.data("tab",n=new t(this));if(typeof i=="string")n[i]()})};e.fn.tab.Constructor=t;e.fn.tab.noConflict=function(){e.fn.tab=i;return this};e(document).on("click.tab.data-api",'[data-toggle="tab"], [data-toggle="pill"]',function(t){t.preventDefault();e(this).tab("show")})}(window.jQuery);var inFrame=window.top!==window.self&&parent.wm_vers,viewport=$("html, body"),viewportScrolled=false;$(document).ready(function(){var e=!!window.userId;if(typeof ACPuzzle!=="undefined"){var t=$("#captcha-script").attr("data-apikey");window.captcha=ACPuzzle.create("e5WbiNDM7ykEp.oPFzvvyFi.ljYsZGEx","captcha",{lang:"en",size:"standard"})}var i=window.location.hash;if(i.length>10&&i.indexOf("scrollTo")!=-1){var o=i.split("scrollTo=")[1].split("&")[0];scrollToElement(o,false,false,null,true)}});(function(e){function t(e,t,i){window._gaq&&window._gaq.push(["_trackEvent",e,t,i])}function i(e){var t=new Image;t.src="/ajax/logMainMenu/?action="+e+"&hash="+(new Date).getTime()}function o(e,t,i){var o=$(i).find("[name="+e+"]");if(o.length){o.val(t)}else{$("<input>",{type:"hidden",value:t,name:e}).appendTo(i)}}Math["inf"]=function(e){return e|10};function n(e){var t=0;for(var i=0,o=e.length;i<o;i++){t+=Math.inf(e.charCodeAt(i))}return e+"&_time="+t}window.sendCommentFormAjax=function(){var t=$("#comment-form");$("#comment-form [name=message]").removeAttr("disabled");$.ajax({type:"POST",url:t.attr("action"),dataType:"json",data:n(t.serialize())}).done(function(t){window.setLoginModalLoading(false);if(e){parent.app.map.fireEvent("comment_sent",t)}else{if(t.code===5||t.code===4){if(t.message){alert(t.message);if(window.userId!==0){window.closeLoginModal()}}window.captcha&&window.captcha.reload()}else if(t.code===0||t.code===1){if(t.num){window.location=window.location.path+(window.location.hash?"&":"#")+"scrollTo=comment-"+t.num}else{if(t.code===5||t.code===4){if(t.message){alert(t.message);if(window.userId!==0){window.closeLoginModal()}}window.captcha&&window.captcha.reload()}else if(t.code===0||t.code===1){if(t.num){window.location=window.location.path+(window.location.hash?"&":"#")+"scrollTo=comment-"+t.num}else{window.location.reload()}}window.location.reload()}}}}).error(function(){window.closeLoginModal()}).always(function(){window.enableCommentForm()});window.setLoginModalLoading(true)};window.modalCloseCallback=function(){window.enableCommentForm();window.switchLoginModalView(1)};window.closeLoginModal=function(){$("#login-modal").modal("hide")};window.switchLoginModalView=function(e){$(".modal-view").hide();switch(e){case 1:$("#modalMain").show();break;case 3:$("#modalChooseName").show();break;case 4:$("#modalAsGuest").show();break;case 5:$("#modalSending").show();default:break}};window.setLoginModalLoading=$("#login-modal")?function(e){$("#login-modal")[e?"addClass":"removeClass"]("loading")}:function(){};(function(e){var t=$("a, strong.category, [data-rel=edit]");var i=function(e){var t=(this.href?this.href:$(this).attr("data-url")).replace("http://"+window.location.hostname,"");if(t){switch($(this).attr("data-rel")){case"proceed":return true;case"toggle":break;case"edit":parent.router.route(t);break;case"category":parent.app.map.filterCategory(parseInt(this.id.replace("category-","")));break;default:parent.jevals="jwindow('"+t+"',1)";break}}e.preventDefault();return false};var o=function(e,t){var o=e.href?e.href.replace(e.hostname,"").replace("http://",""):"",n=e.getAttribute("data-rel"),e=$(e);if(o&&(/(.jpg|.jpeg|.png|.gif)$/g.test(o)||o==="/"||e.attr("target"))){return}if(t){e.on("click",i)}else if(!/toggle/gi.test(n)){var s="";if(n){if(!/language|external|nearby|mapready|category|lightbox|tab|street|place|profile/gi.test(n)&&!/^\/country/.test(o)){s="/#lat="+place.lat+"&lon="+place.lon+"&l="+place.languageId+"&z="+place.zoom+"&m=b&show="}else{if(n.match(/category/gi)){var a=e.attr("id"),r=a.match(/\d+/)[0];e.removeClass("btn-link");o="/#lat="+place.lat+"&lon="+place.lon+"&l="+place.languageId+"&z="+(place.zoom-2)+"&m=b&tag="+r}else if(/profile/gi.test(n)){$('<strong class="'+e.attr("class")+'" id="'+e.attr("id")+'">'+e.text()+"</strong>").insertBefore(e);e.removeAttr("id").css("display","none")}}}if(o){e.attr("href",s+o)}}};for(var n=0,s=t.length;n<s;n++){o(t[n],e)}})(e);var s={upper:$("#upper_ad_block"),center:$("#ad_block_center"),bottom:$("#ad_block_bottom"),footer:$("#ad_block_footer")};if(e){$("html").addClass("inner-object-page")}else{$("#placeinfo-locationtree a").each(function(e,t){if(t.getAttribute("data-rel")!=="street"&&t.innerHTML!=="Delhi"){$(t).replaceWith($("<span>",{text:t.innerHTML}))}})}$("#nearest-hotels li").on({click:function(){window.open(this.getAttribute("data-url"))},mouseover:function(){window.status=this.getAttribute("data-url");return true},mouseout:function(){window.status="";return true}});$("#interesting-places .item-link").on("click",function(e){e.preventDefault();t("Interesting places","Click");var i=this;setTimeout(function(){window.location.href=i.href},100);return false});(function(t,n,s){(function(e){if(!e)return;e=e[0];var t=e.match(/\d+/g),i,o=false,n=false;if(t.length===1&&/\/reply/.test(e)){o=true}for(var s=0,a=t.length;s<a;s++){var r=document.getElementById("comment-"+t[s]);if(r){i=r;r.className+=" comment-highlighted";if($(r).parents("#more-comments").length>0){n=true}}}if(i){$(document).on("ready",function(){if(n){$("#more-comments").addClass("active");$("[data-rel=comments-toggle]").parent().detach()}if(o){showCommentReplyForm(i.id.match(/\d+/)[0])}scrollToElement(i.id,false,200,null,true)})}})(window.location.hash.match(/\/comments\/((\d+),?)*(\/reply)?/g));if(bannedCommunicate)return;s=$(s);s.removeClass("disabled");var a=s.find("ul");if(a){var r=s.find(".delete-comment");a=s.find("input"),voters=s.find(".badge");function l(e,t,i){var o=place.type==2?"/object/edit/?object_type=2&":"/object/edit/?",n="&num="+e+"&id="+place.id+"&lang_id="+place.languageId;$.ajax({type:"GET",url:o+"report=1&mark="+t+n}).done(i)}function d(){var e=parseInt(this.id.match(/\d+/g)[0],10);if(this.id.match(/restore/)){l(e,7,function(){var t=$("#restore-comment-"+e),i=$("#comment-creator-"+e),o=$("#comment-date-"+e),n=$("#comment-content-"+e);t.attr("id","remove-comment-"+e);t.html(localization["remove_this_comment"]);var n=$("#comment-content-"+e);n.removeClass("hidden").removeClass("deleted");i.removeClass("deleted");o.removeClass("deleted");n.removeClass("deleted");$("#after-del-"+e).hide();$("#commentReplies-"+e).removeClass("hide").addClass("active");$("#showCommentReplyForm-"+e).removeClass("hide");$("#showThreadReplyForm-"+e).removeClass("hide");$("#comment-footer-deleted-"+e).removeClass("deleted").addClass("hidden");$("#comment-footer-deleted-"+e).removeClass("deleted").addClass("hidden");$("#hide-comment-"+e).removeClass("deleted").addClass("hidden")})}else{if(confirm(localization["comment_del_confirm"])){l(e,6,function(){var t=$("#remove-comment-"+e);t.attr("id","restore-comment-"+e);t.html(localization["restore_this_comment"]);$("#comment-content-"+e).removeClass("deleted").addClass("hidden");$("#comment-footer-"+e).removeClass("deleted").addClass("hidden");$("#comment-footer-deleted-"+e).removeClass("hidden").addClass("deleted");$("#after-del-"+e).css("display","inline");$("#commentReplies-"+e).removeClass("active").addClass("hide");$("#showCommentReplyForm-"+e).addClass("hide");$("#showThreadReplyForm-"+e).addClass("hide");$("#hide-comment-"+e).removeClass("hidden").addClass("deleted")})}}}var c=window.showComment=function(e){$("#comment-content-"+e).removeClass("hidden").addClass("deleted");$("#comment-footer-"+e).removeClass("hidden").addClass("deleted");$("#comment-footer-deleted-"+e).removeClass("deleted").addClass("hidden")};var f=window.hideComment=function(e){$("#comment-content-"+e).removeClass("deleted").addClass("hidden");$("#comment-footer-"+e).removeClass("deleted").addClass("hidden");$("#comment-footer-deleted-"+e).removeClass("hidden").addClass("deleted")};function m(){var e=$(this).parent();if(!e.hasClass("inactive")){var t=$(this),i=parseInt(this.id.match(/\d+/g)[0],10),o=this.id.match(/good/g)?4:5,n=t.parent();l(i,o,function(){var o=t.html().match(/(^\d)/);o=parseInt(o[0]);t.html(this.innerHTML.replace(/(^\d)/,o+1));e.addClass("inactive");$("#vote-good-"+i).removeClass("badge-good");$("#vote-bad-"+i).removeClass("badge-bad")})}}for(var u=0,p=voters.length;u<p;u++){var h=voters[u];$(h).on("click",m)}for(var u=0,p=r.length;u<p;u++){var v=$(r[u]);if(v.css("display")=="none")continue;v.on("click",d)}}var w=$("[data-rel=comments-toggle]");if(w.length){if(e){$("#more-comments").addClass("active");$("[data-rel=comments-toggle]").parent().remove()}else{w.on("click",function(e){e.preventDefault();$("#more-comments").addClass("active");$("[data-rel=comments-toggle]").parent().remove();return false})}}$("#comments-form-toggle button").on("click",function(){var e=$("#comment-form"),t=e.find("[name=message]");$(this).parent().remove();e.css("display","block");window.scrollTo(0,t.position().top-100);t.focus()});(function(e,t){if(t){$(t).on("click",function(){if(parent.app){parent.app.map.fireEvent("process_delete",[place.id,true])}})}if(e){$(e).on("click",function(){if(parent.app){parent.app.map.fireEvent("process_delete",[place.id,null,parseInt(this.className.match(/\d+/g)[0],10)])}})}})($("#confirm-deletion"),$("#cancel-deletion"));if(t&&n){var g=document.getElementById("comment-username");if(g&&document.cookie.indexOf("guestname_new")==-1){$(g).on("focus",function(){this.value=""})}if($("#comment-form-captcha").length){$("#comment-form-captcha").on("submit",function(e){var t=document.getElementById("comment-input");
allowSend=true;e.preventDefault();if(t.value==""||g&&g.value==""){allowSend=false;i("comment_empty_name");if(g&&g.value==""){$("#no-name-error").css("display","inline-block")}}if(allowSend){var n=g,s=document.getElementById("adcopy_response"),a=document.getElementById("adcopy_challenge"),r=document.getElementById("comment-form");o("guestname",n.value,r);o("adcopy_response",s.value,r);o("adcopy_challenge",a.value,r);window.sendCommentFormAjax()}return false})}window.disableCommentForm=function(){$("#comment-form").addClass("loading");$("#comment-input").attr("disabled","disabled");$("#send-comment").attr("disabled","disabled")};window.enableCommentForm=function(){$("#comment-form").removeClass("loading");$("#comment-input").removeAttr("disabled");$("#send-comment").removeAttr("disabled")};$("#comment-form").on("submit",function(e){var t=$("#comment-input"),o=true;e.preventDefault();i("comment_add");if(t.val()==""){o=false;i("comment_empty_name")}if(o){window.disableCommentForm();if(window.userId!=0){window.sendCommentFormAjax()}else{if(window.inwiki){$("#login-modal").modal().on("hidden",window.enableCommentForm)}else{$("#login-modal").modal().on("hidden",window.modalCloseCallback)}}}return false})}window.showCommentReplyForm=function(e){if(e==-1){var t=document.getElementById("commentReplyForm"),i=document.getElementById("comment-form");$("#commentReply").css("display","none");$(t).append(i);if(i.elements["replyto"]!==undefined){$("#commentReplyToInput").remove()}if(typeof ACPuzzle!=="undefined"){ACPuzzle.reload("")}var o=i.elements["guestname"]||i.elements["message"];scrollToElement(o,200,200,function(){o.focus()})}else if(e){var t=$("#commentReplyForm-"+e),n=$("#comments-form-toggle"),i=document.getElementById("comment-form");$(i).show();$("#commentReply").css("display","inline-block");if(t.length===0){var s=$("#comment-"+e).parents(".comment");if(s.length){showCommentReplyForm(s.attr("id").match(/\d+/)[0])}return}if(t.html()==""){t.append(i);if(i.elements["replyto"]===undefined){var a=document.createElement("input");a.id="commentReplyToInput";a.type="hidden";a.name="replyto";i.appendChild(a)}i.elements["replyto"].value=e}if(typeof ACPuzzle!=="undefined"){ACPuzzle.reload("")}if(typeof n!=="undefined"){n.css("display","none")}var o=i.elements["guestname"]||i.elements["message"];scrollToElement(o,200,200,function(){o.focus()})}}})($("#comment-form"),$("#send-comment"),$("#comments"));var a=function(e,t){e=e.replace(/(_|%20)/g," ").replace(/^ +| +$/g,"");if(!t)e=e.replace("http://","");function i(e){return decodeURIComponent(e.replace(/\.([0-9A-F][0-9A-F])/g,"%$1"))}var o=e.split("#");if(o.length!=2){return i(e)}var n=o[1].replace(/\.F[0-4]\.[89AB][\dA-F]\.[89AB][\dA-F]\.[89AB][\dA-F]/g,i).replace(/\.E[\dA-F]\.[89AB][\dA-F]\.[89AB][\dA-F]/g,i).replace(/\.[CD][\dA-F]\.[89AB][\dA-F]/g,i).replace(/\.[2-7][0-9A-F]/g,function(e){var t=i(e);return"!\"#$%&'()*+,/;<=>?@\\^`~".indexOf(t)>=0?t:e});return i(o[0])+" : "+n};(function(e){if(e.length>0){e.innerHTML=a(e.href);window.decodeUrl=a}})($("#wikipedia-article"));$("#search-form").on("submit",function(e){var t=window.location,i=this.action+"&search="+encodeURIComponent(document.getElementById("search-input").value);window.location=i;e.preventDefault()});(function(e,t){if(t.length){t.on("click",function(t){var i=place.id,o=$(this).attr("data-url"),n=window.location;o=o.replace(n.protocol+"//"+n.host,"");$.ajax({url:"/ajax/check/?function=place_can_edit_protected&obj_id="+i}).done(function(t){if(t=="true"){if(e){parent.router.route(o)}else{window.location=n.protocol+"//"+n.host+"#show="+o}}})})}})(e,$("#add-photo-button"));(function(e){if(e){$(e).on("click",function(){var t=e.find("span");if($("#deleted-childs-list").hasClass("active")){$("#deleted-childs-list").removeClass("active");t[1].removeClass("active");t[0].addClass("active")}else{$("#deleted-childs-list").addClass("active");t[0].removeClass("active");t[1].addClass("active")}})}})($("#deleted-childs-title"));(function(e,i){$(e).on("click",function(e){e.preventDefault();var i=a($(this).attr("href"),true),o=$("#permalink-copy");$(this).css("display","none");o.attr("value",i).on("click",function(){if("setSelectionRange"in this){this.setSelectionRange(0,9999)}else{this.select()}});var n=270;o.css("width",n+5+"px").css("display","inline-block");t("Social","Share","link");o.select()});$(i).on("click",function(e){e.preventDefault();var i={x:$(window).width(),y:$(window).height()},o=500,n=400,s,a,r;s=(i.y-n)/2;a=(i.x-o)/2;t("Social","Share",$(this).attr("title"));window.open($(this).attr("href"),"share","menubar=no,location=no,resizable=no,scrollbars=yes,status=no,height="+n+",width="+o+",top="+s+",left="+a)})})($("#permalink a.permalink"),$("#permalink a.share-link"));(function(e){if(e){window.ACPuzzleOptions={onload:function(){if(typeof ACPuzzle!=="undefined"){window.captcha=ACPuzzle.create(e.apikey,"captcha",{lang:"en",size:"standard"})}}};var t=document.createElement("script");t.type="text/javascript";t.src=e.url;document.body.appendChild(t)}})(this.captcha);var r=this.PageSocial={responseCodes:{SUCCESS:200,SUCCESS_CREATED:201,CHANGE_NAME:111,WRONG_PASSWORD:403,SERVER_ERROR:500,NAME_EXISTS:406,ALREADY_CONNECTED:500},providerNames:{TWITTER:"twitter",FACEBOOK:"facebook",VKONTAKTE:"vkontakte"},socialLogin:function(e){window.setLoginModalLoading(true);if(e===r.providerNames.FACEBOOK){r.Facebook.login()}else if(e===r.providerNames.VKONTAKTE){r.Vkontakte.login()}},setFormUserId:function(e){o("uid",e,document.getElementById("comment-form"));window.userId=e},nameChange:function(e){window.switchLoginModalView(3);e.doAction="nameChangeConfirm";var t=$("#social-change-name-form");t[0]["name"].focus();t.on("submit",function(i){i.preventDefault();$.ajax({method:"post",url:"/user/social/?"+$.param(e),dataType:"json",data:t.serialize()}).done(function(e){var t=$("#status-message");if(e.code===r.responseCodes.SUCCESS||e.code===r.responseCodes.SUCCESS_CREATED){r.setFormUserId(e.userId);window.switchLoginModalView(5);window.sendCommentFormAjax()}else if(e.code===r.responseCodes.NAME_EXISTS){t.html(e.message);t.removeClass("hide")}});return false})},_login:function(e){$.ajax({method:"post",dataType:"json",url:"/user/social/?"+$.param(e)}).done(function(t){window.setLoginModalLoading(false);if(t.code===r.responseCodes.SUCCESS||t.code===r.responseCodes.SUCCESS_CREATED){r.setFormUserId(t.userId);window.switchLoginModalView(5);window.sendCommentFormAjax()}else if(t.code===r.responseCodes.CHANGE_NAME){r.nameChange(e)}else if(t.code===r.responseCodes.ALREADY_CONNECTED){}})},Facebook:{auth:function(e){r.wnd=window.open("/user/"+r.providerNames.FACEBOOK,"Facebook","width=607,height=280,resizable=yes,scrollbars=yes,status=yes");r.Facebook.loginInterval=setInterval(function(){var e=localStorage.getItem("fbloginresult");if(e!=null){if(r.wnd){r.wnd.close()}r.Facebook.login(e)}else if(r.wnd.closed){delete r.wnd;clearTimeout(r.Facebook.loginInterval);window.setLoginModalLoading(false)}},300);window["loginFb"]=function(t){e(t);window["loginFb"]=undefined}},login:function(e){localStorage.removeItem("fbloginresult");clearInterval(r.Facebook.loginInterval);if(!e){r.Facebook.auth(r.Facebook.login)}else if(e!=="error"){r._login({social:r.providerNames.FACEBOOK,accessToken:e})}}},Vkontakte:{auth:function(e){r.wnd=window.open("/user/"+r.providerNames.VKONTAKTE,"Vkontakte","width=607,height=280,resizable=yes,scrollbars=yes,status=yes");r.Vkontakte.loginInterval=setInterval(function(){var e=localStorage.getItem("vkloginresult");if(e!=null){if(r.wnd){r.wnd.close()}r.Vkontakte.login(e)}else if(r.wnd.closed){delete r.wnd;clearTimeout(r.Vkontakte.loginInterval);window.setLoginModalLoading(false)}},300);window["loginVk"]=function(t){e(t);window["loginVk"]=undefined}},login:function(e){localStorage.removeItem("vkloginresult");clearInterval(r.Vkontakte.loginInterval);if(!e){r.Vkontakte.auth(r.Vkontakte.login)}else{if(e!="error"){r._login(params={social:r.providerNames.VKONTAKTE,accessToken:e})}}}}}})(inFrame);function removeHash(){var e,t,i=window.location;if("pushState"in history)history.pushState("",document.title,i.pathname+i.search);else{e=document.body.scrollTop;t=document.body.scrollLeft;i.hash="";document.body.scrollTop=e;document.body.scrollLeft=t}}function scrollToElement(e,t,i,o,n){if(n&&viewportScrolled){return false}if(typeof e=="string"){var s=$("#"+e)}else{var s=$(e)}if(s.length){var t=t||100,i=i||0,a=$(s).position().top-t;$("html, body").animate({scrollTop:a+"px"},i,o)}}viewport.bind("DOMMouseScroll scroll mousedown mousewheel keyup",function(e){if(e.which>0||e.type==="mousedown"||e.type==="mousewheel"){viewport.stop().unbind("DOMMouseScroll scroll mousedown mousewheel keyup");viewportScrolled=true}});